<div class="relative sm:hidden">
  <button
    id="menuBtn"
    class="hamburger relative z-[60] mt-2"
    aria-controls="mobileMenu"
    aria-expanded="false"
    aria-label="Open menu"
  >
    <span class="line"></span>
    <span class="line"></span>
    <span class="line"></span>
  </button>

  <div
    id="menuBackdrop"
    class="mt-9 fixed left-0 right-0 bottom-0 z-[40]
           bg-black/30 backdrop-blur-sm
           opacity-0 pointer-events-none
           transition-opacity duration-200"
    style="top:88px"
  ></div>

  <nav
    id="mobileMenu"
    class="nav-links fixed dark:prose-invert left-0 right-0 z-[50]
           bg-white dark:bg-black
            border-white dark:border-zinc-800/40
           transition-all duration-500
           opacity-0 translate-y-8 pointer-events-none"
    style="top:88px"
  >
    <ul class="px-6 py-5 space-y-2">
      <li><a class="nav-link block text-base font-semibold" href="/">Home</a></li>
      <li><a class="nav-link block text-base font-semibold" href="/about">About</a></li>
      <li><a class="nav-link block text-base font-semibold" href="/posts">Posts</a></li>
      <li><a class="nav-link block text-base font-semibold" href="/guestbook">Guestbook</a></li>
    </ul>
  </nav>
</div>

<style>
  .hamburger .line{
    display:block; width:30px; height:3px; margin:6px 0; background:#000;
    transition: transform .25s ease, opacity .2s ease, background .2s ease;
  }
  html.dark .hamburger .line{ background:#fff; }
  .hamburger.is-open .line:nth-child(1){ transform: translateY(10px) rotate(45deg); }
  .hamburger.is-open .line:nth-child(2){ opacity:0; }
  .hamburger.is-open .line:nth-child(3){ transform: translateY(-10px) rotate(-45deg); }

  @media (min-width: 636px){
    .hamburger{ display:none; }
  }
</style>

<script is:inline>
  (function(){
    const btn = document.getElementById('menuBtn');
    const menu = document.getElementById('mobileMenu');
    const backdrop = document.getElementById('menuBackdrop');

    function syncHeaderHeight(){
      const header = document.querySelector('header');
      const h = header?.offsetHeight ?? 88;
      if (menu) menu.style.top = h + 'px';
      if (backdrop) backdrop.style.top = h + 'px';
    }
    syncHeaderHeight();
    window.addEventListener('resize', syncHeaderHeight);

    function setOpen(open){
      btn?.classList.toggle('is-open', open);
      btn?.setAttribute('aria-expanded', String(open));

      if(open){
        menu?.classList.remove('pointer-events-none');
        menu?.classList.remove('opacity-0','-translate-y-3');
        menu?.classList.add('opacity-100','translate-y-0');

        backdrop?.classList.remove('pointer-events-none','opacity-0');
        backdrop?.classList.add('opacity-100');

        document.body.style.overflow = 'hidden';
      }else{
        menu?.classList.add('pointer-events-none');
        menu?.classList.add('opacity-0','-translate-y-3');
        menu?.classList.remove('opacity-100','translate-y-0');

        backdrop?.classList.add('pointer-events-none','opacity-0');
        backdrop?.classList.remove('opacity-100');

        document.body.style.overflow = '';
      }
    }

    btn?.addEventListener('click', () => {
      const open = btn.getAttribute('aria-expanded') !== 'true';
      setOpen(open);
    });
    backdrop?.addEventListener('click', () => setOpen(false));
    window.addEventListener('keydown', (e) => { if(e.key === 'Escape') setOpen(false); });
  })();
</script>
